<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ucapan Pernikahan</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#eef3f9;
      --bg2:#f7f3ee;
      --card:#ffffff;
      --ink:#1d2433;
      --muted:#6b7280;
      --primary:#111827;
      --accent:#b08968;
      --shadow: 0 18px 50px rgba(17,24,39,.12);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 500px at 20% 15%, rgba(176,137,104,.12), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(17,24,39,.08), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    .batik{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.22;
      background:
        repeating-linear-gradient(45deg,
          rgba(176,137,104,.08) 0 8px,
          rgba(255,255,255,0) 8px 18px);
      mix-blend-mode:multiply;
      filter: blur(.2px);
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }

    /* ========== COVER (tahap 1) ========== */
    .cover{
      width:min(420px, 100%);
      background:rgba(255,255,255,.55);
      border:1px solid rgba(17,24,39,.06);
      backdrop-filter: blur(8px);
      border-radius: calc(var(--radius) + 10px);
      padding: 18px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      animation: rise .9s ease forwards;
    }
    @keyframes rise{to{transform:translateY(0); opacity:1}}
    .card{
      background:var(--card);
      border-radius: var(--radius);
      padding: 28px 22px 22px;
      text-align:center;
      box-shadow: 0 12px 28px rgba(17,24,39,.08);
      position:relative;
      overflow:hidden;
    }
    .icon-bubble{
      width:64px;height:64px;
      margin: 6px auto 16px;
      border-radius:999px;
      display:grid;
      place-items:center;
      background: radial-gradient(circle at 30% 30%, rgba(176,137,104,.18), rgba(255,255,255,0));
    }
    .ring{width:34px;height:34px; animation: pulse 1.8s ease-in-out infinite;}
    @keyframes pulse{0%,100%{transform:scale(1); opacity:1}50%{transform:scale(1.08); opacity:.88}}
    h1{
      font-family:"Playfair Display", serif;
      font-size: 34px;
      line-height:1.05;
      margin: 0 0 10px;
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      font-size:14.5px;
      line-height:1.55;
      margin:0 0 18px;
    }
    .input{
      width:100%;
      margin: 10px 0 4px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
    }
    input{
      width: 92%;
      border:none;
      outline:none;
      border-bottom: 2px solid rgba(17,24,39,.12);
      padding: 12px 10px;
      font-size: 15px;
      background:transparent;
      text-align:center;
      transition:.25s;
    }
    input:focus{border-bottom-color: rgba(176,137,104,.75); transform: translateY(-1px);}
    input::placeholder{color:rgba(107,114,128,.75); font-style:italic}
    .btn{
      width: 92%;
      border:none;
      padding: 14px 16px;
      border-radius: 999px;
      background: linear-gradient(135deg, #111827, #0b1220);
      color:#fff;
      font-weight:700;
      letter-spacing:.12em;
      cursor:pointer;
      box-shadow: 0 14px 24px rgba(17,24,39,.25);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover{transform: translateY(-1px); filter:brightness(1.05)}
    .btn:active{transform: translateY(1px); box-shadow: 0 10px 18px rgba(17,24,39,.22)}
    .hint{margin-top:10px; font-size:12px; color:rgba(107,114,128,.85);}

    /* ========== ENVELOPE (tahap 2) ========== */
    .envelope-screen{
      display:none;
      width: min(520px, 100%);
      text-align:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      opacity:0;
      transform: translateY(10px);
      animation: rise .6s ease forwards;
    }
    .envelope-wrap{
      position:relative;
      width:min(420px, 92vw);
      aspect-ratio: 16/11;
      margin: 0 auto 18px;
      filter: drop-shadow(0 22px 30px rgba(17,24,39,.18));
      cursor:pointer;
    }

    .env-base{
      position:absolute; inset:0;
      background:#ffffff;
      border-radius: 14px;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(17,24,39,.06);
    }
    .env-base::before,
    .env-base::after{
      content:"";
      position:absolute;
      top:0; bottom:0;
      width:55%;
      background: linear-gradient(135deg, rgba(17,24,39,.06), rgba(255,255,255,0));
      opacity:.7;
    }
    .env-base::before{ left:-18%; transform: skewX(-18deg); }
    .env-base::after{ right:-18%; transform: skewX(18deg); }

    .env-flap{
      position:absolute;
      left:0; right:0;
      top:-2px;
      height:56%;
      background:#cfd7e3;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin: 50% 0%;
      transform: rotateX(0deg);
      transition: transform .85s cubic-bezier(.2,.9,.2,1);
      box-shadow: inset 0 -1px 0 rgba(17,24,39,.10);
      z-index: 6;
    }

    .env-bottom{
      position:absolute;
      left:0; right:0;
      bottom:-2px;
      height:56%;
      background:#f3f6fb;
      clip-path: polygon(0 100%, 100% 100%, 50% 0);
      z-index:4;
      box-shadow: inset 0 1px 0 rgba(17,24,39,.06);
    }

    .letter{
      position:absolute;
      left:10%;
      right:10%;
      top:14%;
      height:72%;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 16px 22px rgba(17,24,39,.10);
      transform: translateY(30%);
      opacity:0;
      transition: transform .85s cubic-bezier(.2,.9,.2,1), opacity .35s ease;
      z-index: 5;
      overflow:hidden;
    }
    .letter::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(160px 80px at 25% 20%, rgba(176,137,104,.12), transparent 60%),
        linear-gradient(180deg, rgba(17,24,39,.04), transparent 50%);
      pointer-events:none;
    }
    .letter .lines{
      position:absolute; left:14px; right:14px; top:18px;
      display:grid; gap:10px;
      opacity:.55;
    }
    .line{
      height:10px;
      border-radius: 999px;
      background: rgba(17,24,39,.09);
    }
    .line:nth-child(2){width:86%}
    .line:nth-child(3){width:72%}
    .line:nth-child(4){width:90%}
    .line:nth-child(5){width:64%}

    .seal{
      position:absolute;
      left:50%;
      top:52%;
      transform: translate(-50%,-50%);
      width:64px;height:64px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #1f2937, #0b1220);
      box-shadow: 0 10px 16px rgba(17,24,39,.25);
      border: 3px solid rgba(176,137,104,.9);
      display:grid;
      place-items:center;
      z-index: 7;
      transition: transform .55s ease, opacity .35s ease;
    }
    .seal span{
      color: rgba(176,137,104,.95);
      font-weight:800;
      letter-spacing:.08em;
      font-size:14px;
    }

    .tap-text{
      letter-spacing:.32em;
      color: rgba(255,255,255,.75);
      text-transform:uppercase;
      font-size: 12px;
      text-shadow: 0 8px 22px rgba(17,24,39,.22);
    }

    .envelope-wrap.open .env-flap{ transform: rotateX(170deg); }
    .envelope-wrap.open .seal{
      transform: translate(-50%,-50%) scale(.85);
      opacity:.0;
      pointer-events:none;
    }
    .envelope-wrap.open .letter{ opacity:1; transform: translateY(-6%); }

    /* floating hearts background */
    .float-layer{position:fixed; inset:0; pointer-events:none; overflow:hidden;}
    .heart{
      position:absolute;
      bottom:-40px;
      width: 16px; height: 16px;
      transform: rotate(45deg);
      opacity:.18;
      animation: floatUp linear forwards;
      filter: blur(.2px);
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width: 16px;height:16px;
      border-radius:50%;
      background: rgba(176,137,104,.8);
    }
    .heart{background: rgba(176,137,104,.8);}
    .heart:before{left:-8px; top:0;}
    .heart:after{left:0; top:-8px;}
    @keyframes floatUp{
      to{transform: translateY(-120vh) rotate(45deg); opacity: 0;}
    }

    /* confetti canvas */
    canvas#confetti{
      position:fixed; inset:0;
      pointer-events:none;
      display:none;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      background: rgba(17,24,39,.92);
      color:#fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: .25s ease;
      box-shadow: 0 12px 24px rgba(17,24,39,.22);
      z-index: 60;
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(-2px);}

    /* ===== MODAL BASE ===== */
    .modal{
      position:fixed;
      inset:0;
      background: rgba(15,23,42,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 70;
    }
    .modal.show{ display:flex; }
    .modal-card{
      width:min(480px, 100%);
      background:#fff;
      border-radius: 18px;
      box-shadow: 0 18px 50px rgba(17,24,39,.22);
      border:1px solid rgba(17,24,39,.06);
      padding: 18px 16px 14px;
      text-align:center;
      position:relative;
    }
    .modal-title{
      font-weight: 900;
      letter-spacing: .08em;
      color: rgba(15,23,42,.95);
      margin-bottom: 8px;
    }
    .modal-text{
      color: rgba(55,65,81,.95);
      line-height: 1.7;
      font-size: 15px;
      margin: 6px 0 12px;
      white-space: pre-wrap;
    }
    .btn2{
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding: 11px 14px;
      font-weight:700;
      letter-spacing:.06em;
      background: rgba(17,24,39,.92);
      color:#fff;
      box-shadow: 0 12px 20px rgba(17,24,39,.18);
    }
    .xbtn{
      position:absolute;
      right:12px; top:10px;
      width:38px; height:38px;
      border:none;
      background:transparent;
      font-size:26px;
      color: rgba(107,114,128,.9);
      cursor:pointer;
    }

    /* ===== SYSTEM CRASH SCREEN ===== */
    .crash{
      position:fixed; inset:0;
      background:#000;
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 90;
      padding: 22px;
    }
    .crash.show{ display:flex; }
    .crash-inner{
      text-align:center;
      width:min(560px, 100%);
    }
    .crash-title{
      font-family:"Playfair Display", serif;
      font-weight:700;
      font-size:56px;
      letter-spacing:.08em;
      color:#fff;
      position:relative;
      text-shadow: 2px 0 #ff0033, -2px 0 #00e5ff;
      margin: 0 0 18px;
    }
    .crash-title::after{
      content:attr(data-text);
      position:absolute; left:0; top:0;
      width:100%;
      color:#ff0033;
      opacity:.85;
      animation: glitch 1.4s infinite linear;
      clip-path: inset(10% 0 65% 0);
      transform: translate(2px,2px);
    }
    @keyframes glitch{
      0%{clip-path: inset(0 0 85% 0); transform: translate(-2px,-1px);}
      15%{clip-path: inset(20% 0 55% 0); transform: translate(3px,1px);}
      30%{clip-path: inset(55% 0 25% 0); transform: translate(-3px,0px);}
      45%{clip-path: inset(10% 0 70% 0); transform: translate(4px,-2px);}
      60%{clip-path: inset(65% 0 10% 0); transform: translate(-4px,2px);}
      75%{clip-path: inset(35% 0 35% 0); transform: translate(2px,-1px);}
      100%{clip-path: inset(10% 0 70% 0); transform: translate(-2px,1px);}
    }
    .crash-sub{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color:#ff0033;
      letter-spacing:.22em;
      text-transform:uppercase;
      font-size:14px;
      margin: 10px 0;
    }
    .crash-error{
      color:#ff0033;
      font-weight:800;
      font-size:16px;
    }
    .crash-bar{
      width:min(360px, 92%);
      height: 8px;
      border-radius: 999px;
      background: rgba(255,0,51,.18);
      margin: 18px auto 0;
      overflow:hidden;
      position:relative;
    }
    .crash-bar span{
      position:absolute;
      left:-30%;
      top:0; bottom:0;
      width:30%;
      background: rgba(255,0,51,.8);
      animation: scan 1.4s infinite linear;
      border-radius: 999px;
      filter: blur(.2px);
    }
    @keyframes scan{
      to{ left: 110%; }
    }

    /* shake effect (body) */
    body.shake{
      animation: shake .12s infinite;
    }
    @keyframes shake{
      0%{transform: translate(0,0);}
      20%{transform: translate(-2px,1px);}
      40%{transform: translate(2px,-1px);}
      60%{transform: translate(-1px,-2px);}
      80%{transform: translate(1px,2px);}
      100%{transform: translate(0,0);}
    }
  </style>
</head>

<body>
  <div class="batik"></div>
  <div class="float-layer" id="floatLayer" aria-hidden="true"></div>
  <canvas id="confetti"></canvas>
  <div class="toast" id="toast">‚ú®</div>

  <!-- SYSTEM CRASH overlay -->
  <div class="crash" id="crashScreen" aria-hidden="true">
    <div class="crash-inner">
      <div class="crash-title" data-text="SYSTEM CRASH">SYSTEM CRASH</div>
      <div class="crash-sub">DETECTING ANOMALY...</div>
      <div class="crash-sub">CALCULATING HAPPINESS:</div>
      <div class="crash-sub crash-error">ERROR</div>
      <div class="crash-bar"><span></span></div>
    </div>
  </div>

  <div class="wrap">
    <!-- TAHAP 1: COVER -->
    <section class="cover" id="cover">
      <div class="card">
        <div class="icon-bubble" aria-hidden="true">
          <svg class="ring" viewBox="0 0 64 64" fill="none">
            <path d="M24 30c0-6.6 3.6-12 8-12s8 5.4 8 12c0 8-3.6 16-8 16s-8-8-8-16Z"
                  stroke="rgba(176,137,104,.9)" stroke-width="4" stroke-linecap="round"/>
            <path d="M18 30c0-9.8 6.3-18 14-18s14 8.2 14 18"
                  stroke="rgba(17,24,39,.35)" stroke-width="4" stroke-linecap="round"/>
            <circle cx="44" cy="16" r="5" fill="rgba(176,137,104,.9)"/>
          </svg>
        </div>

        <h1>Selamat Menikah</h1>
        <p class="subtitle">
          Doa terbaik untuk Mba <b id="coupleShort">Dinda</b> yang lagi rayakan hari bahagia.
        </p>

        <div class="input">
          <input id="guestName" autocomplete="name" maxlength="24" placeholder="Tuliskan nama..." />
          <button class="btn" id="openBtn">BUKA PESAN</button>
        </div>
      </div>
    </section>

    <!-- TAHAP 2: AMPLOP -->
    <section class="envelope-screen" id="envelopeScreen">
      <div class="envelope-wrap" id="envelope">
        <div class="env-base"></div>
        <div class="letter" aria-hidden="true">
          <div class="lines">
            <div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div>
          </div>
        </div>
        <div class="env-bottom"></div>
        <div class="env-flap"></div>
        <div class="seal" id="seal"><span id="sealText">ü§ç</span></div>
      </div>
      <div class="tap-text">KETUK AMPLOP UNTUK MEMBUKA</div>
    </section>

    <!-- TAHAP 3: ISI UCAPAN -->
    <main class="invitation" id="invitation" aria-live="polite" style="display:none;width:min(920px,100%);margin:auto;padding:10px 0 70px;">

      <style>
        .w-card{
          width:min(520px, 100%);
          margin: 0 auto;
          background:#fff;
          border-radius: 18px;
          box-shadow: 0 18px 40px rgba(17,24,39,.12);
          border: 1px solid rgba(17,24,39,.06);
          overflow:hidden;
        }
        .w-body{ padding: 26px 22px 18px; }

        .w-frame{
          position:relative;
          padding: 18px 14px 8px;
          text-align:center;
        }
        .w-frame:before,
        .w-frame:after{
          content:"";
          position:absolute;
          inset: 14px 14px auto 14px;
          height: 56px;
          border-top: 1px solid rgba(176,137,104,.55);
          border-left: 1px solid rgba(176,137,104,.55);
          border-right: 1px solid rgba(176,137,104,.55);
          border-bottom: 0;
          border-radius: 10px 10px 0 0;
          pointer-events:none;
        }
        .w-kicker{
          font-size: 12px;
          letter-spacing: .34em;
          text-transform: uppercase;
          color: rgba(107,114,128,.9);
          margin-top: 8px;
        }
        .w-guest{
          font-family:"Playfair Display", serif;
          font-size: 54px;
          margin: 10px 0 2px;
          color:#0f172a;
          line-height:1;
        }
        .w-quote{
          margin: 8px 0 12px;
          color: rgba(176,137,104,.95);
          font-style: italic;
          font-weight: 600;
          letter-spacing:.02em;
        }
        .w-divider{
          width: 82px;
          height: 1px;
          background: rgba(176,137,104,.55);
          margin: 12px auto 0;
        }

        .w-msg{
          text-align:center;
          color: rgba(31,41,55,.92);
          line-height: 1.75;
          font-size: 15px;
          margin: 14px auto 6px;
          white-space: pre-wrap;
          min-height: 140px;
        }

        .mini-card{
          margin: 16px auto 14px;
          border: 1px dashed rgba(17,24,39,.18);
          border-radius: 14px;
          padding: 14px 14px 12px;
          background: rgba(249,250,251,.7);
          text-align:center;
        }
        .mini-row{
          display:grid;
          gap:8px;
          font-size:14px;
          color: rgba(55,65,81,.95);
          line-height: 1.55;
        }
        .mini-row b{ color: rgba(15,23,42,.95); }

        .stat-title{
          text-align:center;
          font-size: 12px;
          letter-spacing:.34em;
          text-transform:uppercase;
          color: rgba(107,114,128,.9);
          margin: 18px 0 10px;
        }

        .stat-wrap{
          display:grid;
          place-items:center;
          gap: 10px;
          padding-bottom: 8px;
        }

        /* PIE CHART 100% mode */
        .pie{
          --main:#0f172a;
          width: 150px;
          height: 150px;
          border-radius: 50%;
          background: conic-gradient(var(--main) 0 100%);
          box-shadow: inset 0 0 0 10px #fff, 0 12px 24px rgba(17,24,39,.10);
          position:relative;
        }
        .pie.bump{ animation: pop .42s ease; }
        @keyframes pop{
          0%{transform:scale(.98)}
          55%{transform:scale(1.05)}
          100%{transform:scale(1)}
        }

        .legend{
          display:flex;
          justify-content:center;
          flex-wrap:wrap;
          gap: 10px 12px;
          margin-top: 6px;
        }
        .legend-item{
          border:1px solid rgba(17,24,39,.10);
          background: rgba(255,255,255,.92);
          border-radius: 999px;
          padding: 8px 10px;
          font-size: 13px;
          color: rgba(55,65,81,.95);
          cursor:pointer;
          display:inline-flex;
          align-items:center;
          gap:8px;
          transition: .2s ease;
          user-select:none;
        }
        .legend-item:hover{ transform: translateY(-1px); }
        .legend-item.active{
          border-color: rgba(176,137,104,.55);
          box-shadow: 0 10px 18px rgba(17,24,39,.08);
        }
        .dot{
          display:inline-block;
          width: 9px; height: 9px;
          border-radius: 999px;
        }
        .legend-item b{ font-weight:900; }

        .stat-note{
          text-align:center;
          font-size: 12px;
          color: rgba(107,114,128,.95);
          margin-top: 6px;
        }

        .claim{
          width: 88%;
          margin: 14px auto 10px;
          border:none;
          border-radius: 999px;
          padding: 14px 16px;
          cursor:pointer;
          background: linear-gradient(135deg, #0f172a, #0b1220);
          color: rgba(176,137,104,.98);
          font-weight: 800;
          letter-spacing: .12em;
          text-transform: uppercase;
          box-shadow: 0 14px 22px rgba(17,24,39,.22);
          display:flex;
          align-items:center;
          justify-content:center;
          gap:10px;
        }

        .sign{
          text-align:center;
          margin: 14px 0 6px;
          color: rgba(107,114,128,.92);
          letter-spacing:.28em;
          text-transform: uppercase;
          font-size: 12px;
        }
        .sign b{
          display:block;
          margin-top: 6px;
          letter-spacing: normal;
          text-transform:none;
          font-family:"Playfair Display", serif;
          font-size: 18px;
          color: rgba(15,23,42,.95);
        }

        .bottom-actions{
          display:grid;
          gap:10px;
          padding: 14px 22px 20px;
        }
        .ghost-btn{
          width:100%;
          border-radius: 999px;
          padding: 12px 14px;
          background: rgba(255,255,255,.9);
          border: 1px solid rgba(239,68,68,.65);
          color: rgba(239,68,68,.9);
          font-weight: 800;
          letter-spacing:.08em;
          cursor:pointer;
        }
        .back{
          text-align:center;
          color: rgba(107,114,128,.95);
          font-size: 14px;
          cursor:pointer;
          user-select:none;
        }
        .back:hover{ text-decoration: underline; }

        /* Claim Doa Modal (gacha) */
        .claim-card{
          width:min(520px, 100%);
          background:#fff;
          border-radius: 18px;
          box-shadow: 0 18px 50px rgba(17,24,39,.22);
          border:1px solid rgba(17,24,39,.06);
          padding: 18px 18px 16px;
          position:relative;
        }
        .claim-loading{
          display:grid;
          place-items:center;
          padding: 26px 10px 14px;
          gap: 14px;
        }
        .claim-spinner{
          width:54px; height:54px;
          border-radius:999px;
          border: 6px solid rgba(176,137,104,.22);
          border-top-color: rgba(176,137,104,.95);
          animation: spin 1s linear infinite;
        }
        @keyframes spin{to{transform:rotate(360deg)}}
        .claim-loading-text{
          font-size: 20px;
          font-weight: 800;
          color: rgba(55,65,81,.95);
        }

        .claim-reward{
          display:grid;
          place-items:center;
          padding: 12px 8px 6px;
          gap: 10px;
          text-align:center;
        }
        .reward-frame{
          width: 100%;
          border-radius: 14px;
          border: 2px solid rgba(59,130,246,.65);
          padding: 16px 14px 14px;
        }
        .claim-icon{
          width: 92px;
          height: 92px;
          border-radius: 999px;
          display:grid;
          place-items:center;
          font-size: 44px;
          margin: 0 auto 8px;
          background: radial-gradient(circle at 30% 30%, rgba(176,137,104,.18), rgba(255,255,255,0));
        }
        .claim-rarity{
          letter-spacing:.38em;
          text-transform: uppercase;
          font-weight: 900;
          font-size: 12px;
          margin: 4px 0 2px;
          color: rgba(59,130,246,.95);
        }
        .claim-title{
          font-family:"Playfair Display", serif;
          font-size: 34px;
          line-height: 1.08;
          color: rgba(15,23,42,.98);
          margin: 6px 0 0;
        }
        .claim-desc{
          max-width: 360px;
          font-style: italic;
          color: rgba(107,114,128,.95);
          line-height: 1.55;
          margin: 8px auto 0;
        }
        .claim-save{
          margin-top: 12px;
          width: 62%;
          border-radius: 999px;
          padding: 12px 14px;
          border: 1px solid rgba(17,24,39,.22);
          background: rgba(255,255,255,.95);
          color: rgba(31,41,55,.95);
          font-weight: 800;
          cursor:pointer;
        }
        .claim-again{
          margin-top: 8px;
          width: 62%;
          border:none;
          border-radius: 999px;
          padding: 12px 14px;
          background: rgba(17,24,39,.92);
          color:#fff;
          font-weight: 800;
          letter-spacing:.06em;
          cursor:pointer;
        }

        /* ===== Recovery modal (mirip screenshot) ===== */
        .recovery-title{
          font-weight: 900;
          font-size: 22px;
          color: rgba(31,41,55,.95);
          margin: 6px 0 4px;
        }
        .recovery-sub{
          color: rgba(107,114,128,.95);
          line-height:1.5;
          margin-bottom: 14px;
        }
        .recovery-spinner{
          width: 52px; height: 52px;
          border-radius: 999px;
          border: 6px solid rgba(234,179,8,.25);
          border-top-color: rgba(234,179,8,.95);
          animation: spin 1s linear infinite;
          margin: 4px auto 6px;
        }
        .progress{
          width: 92%;
          height: 8px;
          margin: 0 auto 6px;
          border-radius: 999px;
          background: rgba(17,24,39,.12);
          overflow:hidden;
        }
        .progress .fill{
          width: 0%;
          height: 100%;
          background: rgba(234,179,8,.95);
          transition: width .12s linear;
        }

        /* ===== Grade modal (E Tidak Lulus) ===== */
        .grade-letter{
          font-weight: 900;
          font-size: 70px;
          color: rgba(239,68,68,.95);
          margin-top: 6px;
          line-height: 1;
        }
        .grade-title{
          font-weight: 900;
          color: rgba(239,68,68,.95);
          font-size: 22px;
          margin: 8px 0 6px;
          letter-spacing:.04em;
        }
        .grade-sub{
          color: rgba(107,114,128,.95);
          margin-bottom: 6px;
        }

        /* ===== Final joke modal (Canda Deng) ===== */
        .joke-kepo{
          color: rgba(34,197,94,.95);
          font-weight: 900;
          font-size: 34px;
          line-height: 1.1;
          margin-top: 10px;
        }
        .joke-subtitle{
          color: rgba(34,197,94,.95);
          font-weight: 900;
          letter-spacing:.08em;
          margin: 6px 0 10px;
          font-size: 18px;
        }
      </style>

      <section class="w-card">
        <div class="w-body">
          <div class="w-frame">
            <div class="w-kicker">UCAPAN UNTUK</div>
            <div class="w-guest" id="guestBig">Dinda</div>
            <div class="w-quote" id="guestTagline">" Halo Mba Dinda, selamat menempuh hidup baru" ü§ç</div>
            <div class="w-divider"></div>
          </div>

          <div class="w-msg" id="mainMessage"></div>

          <div class="mini-card">
            <div class="mini-row" id="auraBox"></div>
          </div>

          <div class="stat-title">STATISTIK HUBUNGAN</div>
          <div class="stat-wrap">
            <div class="pie" id="pieChart" aria-hidden="true"></div>
            <div class="legend" id="legend"></div>
            <div class="stat-note" id="statNote">Ketuk statistiknya ‚Äî pie chart langsung 100% all-in ‚ú®</div>
          </div>

          <button class="claim" id="claimBtn">üéÅ CLAIM DOA TERBAIK</button>

          <div class="sign">
            SALAM HANGAT,
            <b id="senderName">Yoga</b>
          </div>
        </div>

        <div class="bottom-actions">
          <button class="ghost-btn" id="predBtn">üîÆ CEK PREDIKSI KEBAHAGIAAN</button>
          <div class="back" id="resetBtn">‚Üê Kembali ke Awal</div>
        </div>
      </section>

      <!-- Modal Claim Doa (Gacha) -->
      <div class="modal" id="claimModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="claim-card">
          <button class="xbtn" id="claimClose" aria-label="Tutup">√ó</button>

          <div class="claim-loading" id="claimLoading">
            <div class="claim-spinner" aria-hidden="true"></div>
            <div class="claim-loading-text">Mengundi Nasib...</div>
          </div>

          <div class="claim-reward" id="claimReward" style="display:none">
            <div class="reward-frame">
              <div class="claim-icon" id="rewardIcon" aria-hidden="true">‚òï</div>
              <div class="claim-rarity" id="rewardRarity">RARE ITEM</div>
              <div class="claim-title" id="rewardTitle">Kopi Anti Ngantuk Virtual</div>
              <div class="claim-desc" id="rewardDesc">"Menambah stamina bahagia +50, mengurangi drama -10."</div>
            </div>

            <button class="claim-save" id="rewardSave">Simpan Item</button>
            <button class="claim-again" id="rewardAgain">Undi Lagi</button>
          </div>
        </div>
      </div>

      <!-- Modal Recovery -->
      <div class="modal" id="recoveryModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-card">
          <button class="xbtn" id="recoveryClose" aria-label="Tutup">√ó</button>
          <div class="recovery-spinner" aria-hidden="true"></div>
          <div class="recovery-title">System Recovery...</div>
          <div class="recovery-sub">Memulihkan data kebahagiaan dari server cadangan...</div>
          <div class="progress"><div class="fill" id="recoveryFill"></div></div>
        </div>
      </div>

      <!-- Modal Grade -->
      <div class="modal" id="gradeModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-card">
          <button class="xbtn" id="gradeClose" aria-label="Tutup">√ó</button>
          <div class="grade-letter">E</div>
          <div class="grade-title">TIDAK LULUS</div>
          <div class="grade-sub">Terdeteksi anomali pada kebahagiaan kamu.</div>
        </div>
      </div>

      <!-- Modal Joke Result -->
      <div class="modal" id="jokeModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-card">
          <button class="xbtn" id="jokeClose" aria-label="Tutup">√ó</button>
          <div class="joke-kepo">‚Ä¶ (Biar Kepo)</div>
          <div class="joke-subtitle">CANDA DENG! ü§£</div>
          <div class="modal-text" id="jokeText"></div>
          <button class="btn2" id="jokeOk">Alhamdulillah üôå</button>
        </div>
      </div>

    </main>
  </div>

  <script>
    /* ======================
       KONFIGURASI (EDIT INI)
       ====================== */
    const CONFIG = {
      targetDefault: "Dinda",
      sender: "Yoga",
      sealText: "ü§ç",
      tagline: (target) => `" Halo Mba ${target}, selamat menempuh hidup baru" ü§ç`,
      message: (target) => (
`,

"Semoga menjadi keluarga yang sakinah, mawaddah,
warahmah"`
      ),
      aura: (target) => ([
    
      ]),
      statsModes: [
        { label: "Saling Sayang",  value: 100, color: "#0f172a", note: "Mode all-in sayang ü§ç" },
        { label: "Saling Support", value: 100, color: "#b08968", note: "Mode tim solid sat-set ‚ú®" },
        { label: "Lucu-lucuan",    value: 100, color: "#cfd7e3", note: "Mode ketawa bareng (wajib) üòÇ" },
      ],
      rewards: [
        { rarity:"RARE ITEM", icon:"üíç", title:"Doa Langgeng Premium", desc:"‚Äú+100 rukun, -50 salah paham. Bucin sehat ya.‚Äù" },
        { rarity:"RARE ITEM", icon:"üßø", title:"Anti Drama Shield", desc:"‚Äú+80 sabar, -80 ego. Debat boleh, nyakitin jangan.‚Äù" },
        { rarity:"EPIC ITEM", icon:"üçÄ", title:"Berkah Rezeki Booster", desc:"‚Äú+70 rezeki, +60 peluang baik, -10 boros lucu.‚Äù" },
        { rarity:"EPIC ITEM", icon:"ü´∂", title:"Kompak Selamanya", desc:"‚Äú+90 kerja sama, +50 komunikasi sat-set.‚Äù" },
        { rarity:"LEGENDARY", icon:"üè°", title:"Home Sweet Home Aura", desc:"‚Äú+120 adem ayem, +100 pulang jadi tenang.‚Äù" },
        { rarity:"LEGENDARY", icon:"‚ú®", title:"Blessing Ultimate Pack", desc:"‚Äú+999 berkah, +999 bahagia, -999 capek hati.‚Äù" },
      ],
    };

    /* ======================
       HELPERS
       ====================== */
    const $ = (s) => document.querySelector(s);
    const openModal = (el) => { el.classList.add("show"); el.setAttribute("aria-hidden","false"); };
    const closeModal = (el) => { el.classList.remove("show"); el.setAttribute("aria-hidden","true"); };

    function vib(pattern){
      try{ if(navigator.vibrate) navigator.vibrate(pattern); }catch(e){}
    }

    /* ======================
       SELECTORS
       ====================== */
    const cover = $("#cover");
    const envelopeScreen = $("#envelopeScreen");
    const envelope = $("#envelope");
    const sealTextEl = $("#sealText");

    const inv = $("#invitation");
    const targetNameEl = $("#guestName");
    const openBtn = $("#openBtn");

    const coupleShort = $("#coupleShort");
    const floatLayer = $("#floatLayer");

    const toast = $("#toast");
    const canvas = $("#confetti");
    const ctx = canvas.getContext("2d");

    const crashScreen = $("#crashScreen");

    const guestBig = $("#guestBig");
    const guestTagline = $("#guestTagline");
    const mainMessage = $("#mainMessage");
    const auraBox = $("#auraBox");
    const senderName = $("#senderName");

    const pieChart = $("#pieChart");
    const legend = $("#legend");
    const statNote = $("#statNote");

    const claimBtn = $("#claimBtn");
    const predBtn = $("#predBtn");
    const resetBtn = $("#resetBtn");

    // claim modal
    const claimModal = $("#claimModal");
    const claimClose = $("#claimClose");
    const claimLoading = $("#claimLoading");
    const claimReward = $("#claimReward");
    const rewardIcon = $("#rewardIcon");
    const rewardRarity = $("#rewardRarity");
    const rewardTitle = $("#rewardTitle");
    const rewardDesc = $("#rewardDesc");
    const rewardSave = $("#rewardSave");
    const rewardAgain = $("#rewardAgain");

    // crash sequence modals
    const recoveryModal = $("#recoveryModal");
    const recoveryClose = $("#recoveryClose");
    const recoveryFill = $("#recoveryFill");

    const gradeModal = $("#gradeModal");
    const gradeClose = $("#gradeClose");

    const jokeModal = $("#jokeModal");
    const jokeClose = $("#jokeClose");
    const jokeOk = $("#jokeOk");
    const jokeText = $("#jokeText");

    /* ======================
       INIT TEXT
       ====================== */
    senderName.textContent = CONFIG.sender || "Keluarga";
    sealTextEl.textContent = CONFIG.sealText || "‚ù§";

    const savedTarget = localStorage.getItem("targetName");
    const initTarget = (savedTarget || CONFIG.targetDefault || "Dinda").trim();
    targetNameEl.value = initTarget;
    coupleShort.textContent = initTarget;

    targetNameEl.addEventListener("input", () => {
      coupleShort.textContent = (targetNameEl.value || CONFIG.targetDefault || "Dinda").trim();
    });

    /* ======================
       HEARTS BACKGROUND
       ====================== */
    function spawnHeart(){
      const h = document.createElement("div");
      h.className = "heart";
      const x = Math.random() * 100;
      const size = 10 + Math.random() * 18;
      const dur = 6 + Math.random() * 6;
      h.style.left = x + "vw";
      h.style.width = h.style.height = size + "px";
      h.style.animationDuration = dur + "s";
      h.style.opacity = (0.10 + Math.random()*0.18).toFixed(2);
      floatLayer.appendChild(h);
      setTimeout(()=> h.remove(), dur*1000);
    }
    setInterval(spawnHeart, 450);

    /* ======================
       TYPEWRITER
       ====================== */
    async function typeWrite(el, text, speed=12){
      el.textContent = "";
      for(let i=0;i<text.length;i++){
        el.textContent += text[i];
        await new Promise(r=>setTimeout(r, speed));
      }
    }

    /* ======================
       TOAST
       ====================== */
    function showToast(text="‚ú®"){
      toast.textContent = text;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 1200);
    }

    /* ======================
       CONFETTI
       ====================== */
    let particles = [];
    let raf;

    function resizeCanvas(){
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function fireConfetti(duration=800){
      canvas.style.display = "block";
      const tEnd = performance.now() + duration;

      const count = 170;
      for(let i=0;i<count;i++){
        particles.push({
          x: Math.random() * window.innerWidth,
          y: -20 - Math.random()*window.innerHeight*0.2,
          vx: -2 + Math.random()*4,
          vy: 3 + Math.random()*5,
          w: 4 + Math.random()*6,
          h: 6 + Math.random()*10,
          rot: Math.random()*Math.PI,
          vr: -0.15 + Math.random()*0.3,
          c: ["#0f172a","#b08968","#ffffff","#cfd7e3"][Math.floor(Math.random()*4)]
        });
      }

      cancelAnimationFrame(raf);
      (function loop(now){
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

        particles = particles.filter(p => p.y < window.innerHeight + 40);
        for(const p of particles){
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vr;

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = p.c;
          ctx.globalAlpha = 0.9;
          ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          ctx.restore();
        }

        if(now < tEnd || particles.length){
          raf = requestAnimationFrame(loop);
        }else{
          canvas.style.display = "none";
        }
      })(performance.now());
    }

    /* ======================
       STAT MODE (100% semua)
       ====================== */
    let currentMode = 0;
    let autoCycleTimer = null;

    function stopAutoCycle(){
      if(autoCycleTimer){
        clearInterval(autoCycleTimer);
        autoCycleTimer = null;
      }
    }

    function setMode(i, {fromAuto=false} = {}){
      currentMode = i;
      const m = CONFIG.statsModes[i];

      pieChart.style.setProperty("--main", m.color);

      pieChart.classList.remove("bump");
      void pieChart.offsetWidth;
      pieChart.classList.add("bump");

      legend.querySelectorAll(".legend-item").forEach((btn, idx) => {
        btn.classList.toggle("active", idx === i);
      });

      statNote.textContent = m.note + " ‚Äî (ketuk lagi kalau mau ganti)";

      if(!fromAuto) stopAutoCycle();
    }

    function renderStats(){
      legend.innerHTML = CONFIG.statsModes.map((m, i) => `
        <button type="button" class="legend-item ${i===0 ? "active":""}" data-i="${i}">
          <span class="dot" style="background:${m.color}"></span>
          <b>${m.value}%</b> ${m.label}
        </button>
      `).join("");

      legend.querySelectorAll(".legend-item").forEach(btn => {
        btn.addEventListener("click", () => setMode(parseInt(btn.dataset.i, 10)));
      });

      setMode(0, {fromAuto:true});
    }

    function startAutoCycle(){
      stopAutoCycle();
      let loops = 0;
      autoCycleTimer = setInterval(() => {
        setMode((currentMode + 1) % CONFIG.statsModes.length, {fromAuto:true});
        loops++;
        if(loops >= 9) stopAutoCycle();
      }, 1100);
    }

    /* ======================
       ISI KARTU SAAT DIBUKA
       ====================== */
    async function fillInvitation(){
      const target = (localStorage.getItem("targetName") || CONFIG.targetDefault || "Dinda").trim();

      guestBig.textContent = target;
      guestTagline.textContent = CONFIG.tagline(target);

      auraBox.innerHTML = CONFIG.aura(target).map(x => `<div>${x}</div>`).join("");

      renderStats();
      startAutoCycle();

      const msg = CONFIG.message(target);
      await typeWrite(mainMessage, msg, 12);
    }

    /* ======================
       FLOW: COVER -> AMPLOP
       ====================== */
    openBtn.addEventListener("click", () => {
      const target = (targetNameEl.value || CONFIG.targetDefault || "Dinda").trim();
      localStorage.setItem("targetName", target);

      cover.style.transition = "0.45s ease";
      cover.style.transform = "translateY(6px) scale(.98)";
      cover.style.opacity = "0";

      setTimeout(() => {
        cover.style.display = "none";
        envelopeScreen.style.display = "block";
        window.scrollTo({top:0, behavior:"smooth"});
      }, 420);
    });
    targetNameEl.addEventListener("keydown", (e)=> {
      if(e.key === "Enter") openBtn.click();
    });

    /* ======================
       FLOW: AMPLOP -> KARTU
       ====================== */
    let opened = false;
    envelope.addEventListener("click", async () => {
      if(opened) return;
      opened = true;

      envelope.classList.add("open");

      setTimeout(() => {
        envelopeScreen.style.transition = "0.5s ease";
        envelopeScreen.style.opacity = "0";
        envelopeScreen.style.transform = "translateY(6px) scale(.99)";
      }, 900);

      setTimeout(async () => {
        envelopeScreen.style.display = "none";
        inv.style.display = "block";
        window.scrollTo({top:0, behavior:"smooth"});

        fireConfetti(700);
        await fillInvitation();
      }, 1450);
    });

    /* ======================
       CLAIM DOA (GACHA MODAL)
       ====================== */
    function rarityColor(r){
      if(r === "LEGENDARY") return "rgba(245,158,11,.95)";
      if(r === "EPIC ITEM") return "rgba(139,92,246,.95)";
      return "rgba(59,130,246,.95)";
    }

    let lastReward = null;

    function openClaimLoading(){
      openModal(claimModal);
      claimLoading.style.display = "grid";
      claimReward.style.display = "none";
    }

    function showReward(){
      const pick = CONFIG.rewards[Math.floor(Math.random() * CONFIG.rewards.length)];
      lastReward = pick;

      rewardIcon.textContent = pick.icon;
      rewardRarity.textContent = pick.rarity;
      rewardRarity.style.color = rarityColor(pick.rarity);
      rewardTitle.textContent = pick.title;
      rewardDesc.textContent = pick.desc;

      claimLoading.style.display = "none";
      claimReward.style.display = "grid";

      fireConfetti(900);
    }

    function closeClaim(){ closeModal(claimModal); }

    claimBtn.addEventListener("click", () => {
      openClaimLoading();
      setTimeout(showReward, 1200);
    });

    claimClose.addEventListener("click", closeClaim);
    claimModal.addEventListener("click", (e) => {
      if(e.target === claimModal) closeClaim();
    });

    rewardAgain.addEventListener("click", () => {
      openClaimLoading();
      setTimeout(showReward, 900);
    });

    rewardSave.addEventListener("click", async () => {
      if(!lastReward) return;
      const text = `${lastReward.rarity} ‚Äî ${lastReward.title}\n${lastReward.desc}`;
      try{ await navigator.clipboard.writeText(text); }catch(e){}
      showToast("Item tersalin ‚ú®");
    });

    /* ======================
       PREDIKSI: SYSTEM CRASH SEQUENCE
       ====================== */
    const PRED = [
      "98% langgeng, 2% debat: mau makan apa.\nSolusi: suit Jepang. ü•¢üòÇ",
      "Rejeki: lancar.\nBonus: makin sering ketawa bareng sampai lupa jam. ‚ú®",
      "Kalau lagi capek: jadi tim yang saling menguatkan.\nMinimal: peluk dulu, baru cerita. ü´∂",
      "Bucin: aman dan sehat.\nCatatan: quality time tanpa HP kadang-kadang ya. üìµü§ç",
    ];

    let recoveryTimer = null;

    function showCrash(){
      crashScreen.classList.add("show");
      crashScreen.setAttribute("aria-hidden","false");

      // getar & shake (mobile friendly)
      document.body.classList.add("shake");
      vib([120, 60, 120, 60, 200, 80, 200]);

      setTimeout(() => {
        document.body.classList.remove("shake");
      }, 1500);
    }

    function hideCrash(){
      crashScreen.classList.remove("show");
      crashScreen.setAttribute("aria-hidden","true");
    }

    function startRecovery(next){
      openModal(recoveryModal);
      recoveryFill.style.width = "0%";

      let p = 0;
      if(recoveryTimer) clearInterval(recoveryTimer);

      recoveryTimer = setInterval(() => {
        p += 4 + Math.random() * 8;
        if(p >= 100){
          p = 100;
          recoveryFill.style.width = p + "%";
          clearInterval(recoveryTimer);

          setTimeout(() => {
            closeModal(recoveryModal);
            next?.();
          }, 250);
        } else {
          recoveryFill.style.width = p + "%";
        }
      }, 90);
    }

    function showGradeThenJoke(){
      openModal(gradeModal);
      vib([80, 40, 80]);

      setTimeout(() => {
        closeModal(gradeModal);
        showJokeResult();
      }, 850);
    }

    function showJokeResult(){
      const pick = PRED[Math.floor(Math.random()*PRED.length)];
      jokeText.textContent =
`Nilai aman kok! (Aamiin... Semoga yaa).
Semoga rumah tangganya adem, rezekinya lancar, dan hatinya selalu pulang. ü§ç

Prediksi:
${pick}`;

      openModal(jokeModal);
    }

    predBtn.addEventListener("click", () => {
      // sequence: CRASH -> RECOVERY -> GRADE -> JOKE
      showCrash();
      setTimeout(() => {
        hideCrash();
        startRecovery(showGradeThenJoke);
      }, 2200);
    });

    // close handlers
    recoveryClose.addEventListener("click", () => closeModal(recoveryModal));
    gradeClose.addEventListener("click", () => closeModal(gradeModal));
    jokeClose.addEventListener("click", () => closeModal(jokeModal));
    jokeOk.addEventListener("click", () => closeModal(jokeModal));

    [recoveryModal, gradeModal, jokeModal].forEach(m => {
      m.addEventListener("click", (e) => { if(e.target === m) closeModal(m); });
    });

    /* ======================
       RESET
       ====================== */
    resetBtn.addEventListener("click", () => {
      opened = false;
      envelope.classList.remove("open");

      inv.style.display = "none";
      envelopeScreen.style.display = "none";

      cover.style.display = "block";
      cover.style.opacity = "1";
      cover.style.transform = "translateY(0)";

      mainMessage.textContent = "";
      stopAutoCycle();
      window.scrollTo({top:0, behavior:"smooth"});
    });
  </script>
</body>
</html>

<!-- trigger github pages rebuild -->
